<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Empleados</title>
    <style>
        * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: Arial, sans-serif;
    background-color: #f4f4f4;
    color: #333;
    line-height: 1.6;
}

.container {
    max-width: 800px;
    margin: 20px auto;
    padding: 20px;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

h1, h2 {
    margin-bottom: 20px;
    color: #007BFF;
}

.formGroup {
    margin-bottom: 15px;
}

.formGroup label {
    display: block;
    margin-bottom: 5px;
}

.formGroup input, .formGroup select {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    transition: border-color 0.3s;
}

.formGroup input:focus, .formGroup select:focus {
    border-color: #007BFF;
}

button {
    padding: 10px 15px;
    border: none;
    border-radius: 5px;
    background: #007BFF;
    color: white;
    cursor: pointer;
    transition: background 0.3s;
}

button:hover {
    background: #0056b3;
}

fieldset {
    border: none;
    margin-bottom: 15px;
}

legend {
    font-weight: bold;
}

.employeeDataContainer {
    margin-top: 30px;
    display: flex;
    flex-direction: column; /* Cambia a columna para organizar por empleado */
}

.employeeCard {
    background: #e9ecef;
    border-radius: 5px;
    padding: 15px;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    margin-bottom: 15px; /* Espacio entre tarjetas de empleados */
}

.employeeCard img {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    margin-right: 15px;
}

.employeeInfo {
    flex: 1;
}

.employeeInfo h3 {
    margin: 0;
    font-size: 1.2em;
    color: #007bff; /* Color para el nombre de la sucursal */
}

.employeeDetails {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.8em;
    border: 1px solid;
    padding: 10px;
}

.editable {
    background: #fff3cd;
    padding: 2px 5px;
    border: 1px solid #ffeeba;
    border-radius: 5px;
    display: inline-block;
    cursor: text; /* Cambia el cursor para que parezca editable */
}

.editable:hover {
    background: #ffeeba;
}


.editable:hover {
    background: #ffeeba;
}

body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    background-color: #f4f4f4;
}

.employeeDataContainer {
    display: flex;
    flex-wrap: wrap;
    gap: 20px; /* Espaciado entre tarjetas */
}

.employeeCard {
    display: flex;
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    width: calc(33% - 20px); /* Tres columnas */
    padding: 15px;
    align-items: center;
}

.employeeCard img {
    border-radius: 50%; /* Imagen circular */
    width: 80px; /* Ancho de la imagen */
    height: 80px; /* Alto de la imagen */
    margin-right: 15px; /* Espaciado a la derecha de la imagen */
}

.employeeInfo {
    flex: 1; /* Permitir que el contenido ocupe el espacio restante */
}

h3 {
    margin: 0;
    font-size: 1.2em;
}

p {
    margin: 5px 0;
}

.employeeDetail {
    font-size: 0.9em;
    color: #555; /* Color gris para detalles */
}

.antiguedad {
    font-weight: bold; /* Resaltar la antigüedad */
}

.editable {
    border: 1px dashed #007bff;
    padding: 2px 5px;
    border-radius: 4px;
    cursor: text; /* Cambiar el cursor a texto */
}

.editable:hover {
    background-color: #f0f8ff; /* Color de fondo al pasar el ratón */
}

img.employeePhoto {
    width: 100px;
}


    </style>
</head>
<body>
    <div class="container">
        <h1>Formulario de Empleado</h1>
        <form id="employeeForm">
            <div class="formGroup">
                <label for="fullName">Nombre y Apellido:</label>
                <input type="text" id="fullName" required>
            </div>
            <div class="formGroup">
                <label for="employeeId">Legajo:</label>
                <input type="text" id="employeeId" required>
            </div>
            <div class="formGroup">
                <label for="hireDate">Fecha de Contratación:</label>
                <input type="date" id="hireDate" required>
            </div>
            <div class="formGroup">
                <label for="position">Cargo:</label>
                <select id="position" required>
                    <option value="Postulante">Postulante</option>
                </select>
            </div>
            <div class="formGroup">
                <label for="assignmentDate">Fecha de Asignación del Cargo:</label>
                <input type="date" id="assignmentDate" required>
            </div>
            <div class="formGroup">
                <label for="category">Categoría:</label>
                <select id="category" required>
                    <option value="Cajero B">Cajero B</option>
                    <option value="Auxiliar A">Auxiliar A</option>
                </select>
            </div>
            <div class="formGroup">
                <label for="categoryAssignmentDate">Fecha de Asignación de Categoría:</label>
                <input type="date" id="categoryAssignmentDate" required>
            </div>
            <div class="formGroup">
                <label for="branch">Sucursal (solo números):</label>
                <input type="number" id="branch" required>
            </div>
            <div class="formGroup">
                <label for="branchAssignmentDate">Fecha de Asignación de Sucursal:</label>
                <input type="date" id="branchAssignmentDate" required>
            </div>
            <div class="formGroup">
                <label for="photo">Subir Foto:</label>
                <input type="file" id="photo" accept="image/*" required>
            </div>
            <fieldset>
                <legend>Evaluación:</legend>
                <label>
                    <input type="radio" name="evaluation" value="Bien" required> Bien
                </label>
                <label>
                    <input type="radio" name="evaluation" value="Regular"> Regular
                </label>
                <label>
                    <input type="radio" name="evaluation" value="Mal"> Mal
                </label>
            </fieldset>
            <button type="submit">Agregar Empleado</button>
        </form>

        <h2>Empleados Cargados</h2>
        <div id="employeeData" class="employeeDataContainer"></div>
    </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, updateDoc, doc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-storage.js";
    
        const firebaseConfig = {
            apiKey: "AIzaSyBjDElF__Bcgo137GGf6hPRXhEp4BatD10",
            authDomain: "recaudaciones-26766.firebaseapp.com",
            projectId: "recaudaciones-26766",
            storageBucket: "recaudaciones-26766.appspot.com",
            messagingSenderId: "793331710217",
            appId: "1:793331710217:web:93d036faa48032a6f53bd8"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);
    
        document.getElementById("employeeForm").addEventListener("submit", async function(event) {
            event.preventDefault();
    
            // Obtener datos del formulario
            const fullName = document.getElementById("fullName").value;
            const employeeId = document.getElementById("employeeId").value;
            const hireDate = document.getElementById("hireDate").value;
            const position = document.getElementById("position").value;
            const assignmentDate = document.getElementById("assignmentDate").value;
            const category = document.getElementById("category").value;
            const categoryAssignmentDate = document.getElementById("categoryAssignmentDate").value;
            const branch = document.getElementById("branch").value;
            const branchAssignmentDate = document.getElementById("branchAssignmentDate").value;
            const evaluation = document.querySelector('input[name="evaluation"]:checked').value;
            const photoFile = document.getElementById("photo").files[0];
    
            let photoURL = '';
            if (photoFile) {
                const storageRef = ref(storage, `photos/${employeeId}.jpg`);
                await uploadBytes(storageRef, photoFile);
                photoURL = await getDownloadURL(storageRef);
            }
    
            // Agregar el empleado a Firestore
            await addDoc(collection(db, "employees"), {
                fullName: fullName,
                employeeId: employeeId,
                hireDate: hireDate,
                position: position,
                assignmentDate: assignmentDate,
                category: category,
                categoryAssignmentDate: categoryAssignmentDate,
                branch: branch,
                branchAssignmentDate: branchAssignmentDate,
                evaluation: evaluation,
                photoURL: photoURL
            });
    
            document.getElementById("employeeForm").reset();
            loadEmployees();
        });
    
        async function loadEmployees() {
            const employeeContainer = document.getElementById("employeeData");
            employeeContainer.innerHTML = ""; // Limpiar la visualización anterior
    
            const querySnapshot = await getDocs(collection(db, "employees"));
            querySnapshot.forEach(doc => {
                const data = doc.data();
                const employeeDiv = document.createElement("div");
                employeeDiv.className = "employeeInfo";
                employeeDiv.innerHTML = `
                    <div class="employeeDetails">
                        <img src="${data.photoURL}" alt="Foto de ${data.fullName}" class="employeePhoto">
                        <div class="employeeDetails-deta">
                        <h3 id="employeeName">${data.fullName}</h3>
                        <p id="employeeIdDisplay">Legajo: <span id="employeeIdValue">${data.employeeId}</span></p>
                        <p id="branchDisplay">Sucursal: <span id="branchValue">${data.branch}</span></p>
                        <p id="positionDisplay">Cargo: <span id="positionValue">${data.position}</span></p>
                        <p id="positionDisplay">Evaluación: <span id="evaluationDisplay" contenteditable="true">${data.evaluation}</span></p>
                        </div>
                        <div class="employeeDetails-deta-time">
                        <h3 id="employeeName">Antigüedad</h3>
                        <p>Empresa: <span id="seniorityCompany">${calculateSeniority(data.hireDate)}</span></p>
                        <p>Sucursal: <span id="seniorityBranch">${calculateSeniority(data.branchAssignmentDate)}</span></p>
                        <p>Categoría: <span id="seniorityCategory">${calculateSeniority(data.categoryAssignmentDate)}</span></p>
                        <p>Puesto: <span id="seniorityPosition">${calculateSeniority(data.assignmentDate)}</span></p>
                        </div>
                    </div>
                `;
                employeeContainer.appendChild(employeeDiv);
            });
        }
    
        function calculateSeniority(startDate) {
            const start = new Date(startDate);
            const now = new Date();
            const years = now.getFullYear() - start.getFullYear();
            const months = now.getMonth() - start.getMonth();
            const days = now.getDate() - start.getDate();
    
            let yearsDisplay = years;
            let monthsDisplay = months;
            let daysDisplay = days;
    
            if (days < 0) {
                monthsDisplay--;
                daysDisplay += new Date(now.getFullYear(), now.getMonth(), 0).getDate();
            }
    
            if (monthsDisplay < 0) {
                yearsDisplay--;
                monthsDisplay += 12;
            }
    
            return `${yearsDisplay} años, ${monthsDisplay} meses y ${daysDisplay} días`;
        }
    
        // Cargar empleados al inicio
        loadEmployees();
    </script>
    
</body>
</html>
